<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="CyberPosture">
<meta name="theme-color" content="#0f172a">
<title>CyberPosture</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;font-family:system-ui,-apple-system,sans-serif;background:#f0f4f8;color:#0f172a}
#outer{height:100%;height:100dvh;display:flex;flex-direction:column;max-width:600px;margin:0 auto}
#screen{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch}
#nav{display:flex;background:#0f172a;border-top:1px solid rgba(255,255,255,.08);flex-shrink:0;padding-bottom:env(safe-area-inset-bottom)}
#modalroot{position:fixed;inset:0;pointer-events:none;z-index:100}
#modalroot:not(:empty){pointer-events:all}
.nb{flex:1;padding:10px 4px 12px;display:flex;flex-direction:column;align-items:center;gap:3px;border:none;background:none;cursor:pointer;color:#475569;font-size:8px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;font-family:inherit}
.nb.on{color:#34d399}
.nb-ic{font-size:20px;line-height:1}
.hdr{background:#0f172a;padding:12px 16px;padding-top:max(12px,env(safe-area-inset-top));display:flex;align-items:center;gap:12px;flex-shrink:0}
.logo-dot{width:22px;height:22px;border-radius:50%;background:#34d399;box-shadow:0 0 12px #34d399;flex-shrink:0}
.back-btn{width:34px;height:34px;border-radius:50%;background:rgba(255,255,255,.1);border:1.5px solid rgba(255,255,255,.2);color:#fff;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.card{background:#fff;border:1.5px solid #e2e8f0;border-radius:14px;padding:16px}
input[type=text]{width:100%;background:#f8fafc;border:2px solid #e2e8f0;border-radius:10px;padding:13px 14px;font-size:16px;font-weight:600;color:#0f172a;outline:none;font-family:inherit;-webkit-appearance:none}
input[type=text]:focus{border-color:#059669}
input[type=text]::placeholder{color:#94a3b8;font-weight:400}
.btn-go{width:100%;margin-top:10px;padding:15px;background:#059669;border:none;border-radius:12px;color:#fff;font-weight:800;font-size:15px;cursor:pointer;font-family:inherit}
.btn-go:active{opacity:.85}
.btn-go:disabled{background:#94a3b8;cursor:default}
.pill{background:#fff;border:1.5px solid #e2e8f0;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#334155;cursor:pointer;font-family:inherit}
.pill:active{border-color:#059669;color:#059669;background:#f0fdf4}
.dot{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;flex-shrink:0;border:2px solid}
.dp{background:#d1fae5;border-color:#6ee7b7;color:#059669}
.dw{background:#fef3c7;border-color:#fcd34d;color:#d97706}
.df{background:#fee2e2;border-color:#fca5a5;color:#dc2626}
.ds{background:#f1f5f9;border-color:#cbd5e1;color:#94a3b8}
.chkrow{display:flex;align-items:flex-start;gap:12px;padding:13px 14px;border-bottom:1px solid #f1f5f9;cursor:pointer;-webkit-user-select:none}
.chkrow:last-child{border-bottom:none}
.chkrow:active{background:#f8fafc}
.nstag{font-size:9px;font-weight:700;color:#94a3b8;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:4px;padding:1px 5px}
.prog-track{height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden;margin-top:8px}
.prog-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,#059669,#34d399);transition:width .4s}
.ring-wrap{position:relative;flex-shrink:0}
.ring-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:flex-end;z-index:100}
.modal-box{background:#fff;border-radius:18px 18px 0 0;width:100%;padding:18px 18px;padding-bottom:max(24px,env(safe-area-inset-bottom));max-height:85vh;overflow-y:auto}
.modal-handle{width:40px;height:4px;background:#e2e8f0;border-radius:2px;margin:0 auto 16px}
.hist-row{background:#fff;border:1.5px solid #e2e8f0;border-radius:12px;padding:14px;margin-bottom:10px;cursor:pointer;display:flex;align-items:center;gap:10px}
.hist-row:active{border-color:#059669}
.slabel{font-size:10px;font-weight:700;color:#94a3b8;letter-spacing:.1em;text-transform:uppercase;margin-bottom:8px}
.live-badge{display:inline-flex;align-items:center;gap:4px;font-size:9px;font-weight:700;color:#059669;background:rgba(5,150,105,.08);border:1px solid rgba(5,150,105,.2);border-radius:4px;padding:2px 7px}
.live-dot{width:5px;height:5px;border-radius:50%;background:#059669;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.prio-box{background:#fff;border:2px solid #fca5a5;border-radius:14px;padding:14px}
.prio-num{width:22px;height:22px;border-radius:50%;background:#fee2e2;border:2px solid #fca5a5;color:#dc2626;font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
@keyframes sh{0%{background-position:200% 0}100%{background-position:-200% 0}}
.shimmer{background:linear-gradient(90deg,#e2e8f0 0%,#f8fafc 50%,#e2e8f0 100%);background-size:200% 100%;animation:sh 1.3s infinite;border-radius:3px}
</style>
</head>
<body>
<div id="outer">
  <div id="screen"></div>
  <div id="nav"></div>
  <div id="modalroot"></div>
</div>
<script>
var CHECKS=[
  {id:'ssl',   label:'SSL/TLS Certificate',  cat:'Encryption',    w:15},
  {id:'hsts',  label:'HSTS Enforcement',     cat:'Encryption',    w:8},
  {id:'hdrs',  label:'HTTP Security Headers',cat:'Web Security',  w:12},
  {id:'ckys',  label:'Cookie Security',      cat:'Web Security',  w:5},
  {id:'spf',   label:'SPF Record',           cat:'Email',         w:10},
  {id:'dkim',  label:'DKIM Signing',         cat:'Email',         w:8},
  {id:'dmarc', label:'DMARC Policy',         cat:'Email',         w:10},
  {id:'dns',   label:'DNSSEC',               cat:'Infrastructure',w:10},
  {id:'ports', label:'Exposed Services',     cat:'Infrastructure',w:10},
  {id:'breach',label:'Breach Indicators',    cat:'Threat Intel',  w:12},
  {id:'cve',   label:'Known CVEs',           cat:'Threat Intel',  w:10},
];
var GRADES=[
  {min:85,g:'A',lbl:'Excellent',    col:'#059669'},
  {min:70,g:'B',lbl:'Good',         col:'#16a34a'},
  {min:50,g:'C',lbl:'Moderate Risk',col:'#d97706'},
  {min:30,g:'D',lbl:'High Risk',    col:'#ea580c'},
  {min:0, g:'F',lbl:'Critical Risk',col:'#dc2626'},
];

var ST={screen:â€˜homeâ€™,input:â€™â€™,domain:â€™â€™,results:{},scanning:false,progress:0,msg:â€™â€™,history:[],modal:null};
function set(p){Object.assign(ST,p);render();}
function esc(s){return s?String(s).replace(/&/g,â€™&â€™).replace(/</g,â€™<â€™).replace(/>/g,â€™>â€™).replace(/â€/g,â€™"â€™):â€™â€™;}
function sleep(ms){return new Promise(function(r){setTimeout(r,ms);});}
function getGrade(s){if(s===null)return{g:â€™?â€™,lbl:â€˜No dataâ€™,col:â€™#94a3b8â€™};for(var i=0;i<GRADES.length;i++)if(s>=GRADES[i].min)return GRADES[i];return GRADES[GRADES.length-1];}
function calcScore(res){
var t=0,m=0;
CHECKS.forEach(function(c){var r=res[c.id];if(!r||r.s===â€˜skipâ€™)return;m+=c.w;if(r.s===â€˜passâ€™)t+=c.w;else if(r.s===â€˜warnâ€™)t+=c.w*0.5;});
return m===0?null:Math.round((t/m)*100);
}
function dotEl(s){
var cls={pass:â€˜dpâ€™,warn:â€˜dwâ€™,fail:â€˜dfâ€™,skip:â€˜dsâ€™};
var ic={pass:â€˜âœ“â€™,warn:â€˜âš â€™,fail:â€˜âœ•â€™,skip:â€™â€”â€™};
return â€˜<div class="dot '+(cls[s]||'ds')+'">â€™+(ic[s]||â€™â€”â€™)+â€™</div>â€™;
}
function toDom(s){
var t=s.toLowerCase().trim().replace(/^https?:///,â€™â€™).split(â€™/â€™)[0];
if(t.includes(â€™.â€™))return t;
var m={microsoft:â€˜microsoft.comâ€™,google:â€˜google.comâ€™,amazon:â€˜amazon.comâ€™,apple:â€˜apple.comâ€™,
meta:â€˜meta.comâ€™,facebook:â€˜facebook.comâ€™,shell:â€˜shell.comâ€™,hsbc:â€˜hsbc.comâ€™,
nca:â€˜nca.gov.ukâ€™,bbc:â€˜bbc.co.ukâ€™,tesla:â€˜tesla.comâ€™,â€˜british airwaysâ€™:â€˜ba.comâ€™,
ba:â€˜ba.comâ€™,lloyds:â€˜lloydsbank.comâ€™,barclays:â€˜barclays.comâ€™,bt:â€˜bt.comâ€™,
bp:â€˜bp.comâ€™,vodafone:â€˜vodafone.comâ€™,netflix:â€˜netflix.comâ€™,tesco:â€˜tesco.comâ€™,
natwest:â€˜natwestgroup.comâ€™,nvidia:â€˜nvidia.comâ€™};
return m[t]||(t+â€™.comâ€™);
}

// â”€â”€ Safe fetch â€” NO AbortController (Safari iOS compat) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Returns response or throws. Uses Promise.race with a timeout promise.
function safeFetch(url, opts) {
var timeout = (opts && opts.timeout) || 10000;
var fetchOpts = {};
if (opts && opts.headers) fetchOpts.headers = opts.headers;
// No signal â€” avoids â€œobject cannot be clonedâ€ Safari bug
var fetchP = fetch(url, fetchOpts);
var timeoutP = new Promise(function(_, rej) {
setTimeout(function() { rej(new Error(â€˜timeoutâ€™)); }, timeout);
});
return Promise.race([fetchP, timeoutP]);
}

// Try a URL with optional CORS proxies
async function tryFetch(url, opts) {
var proxies = [
url,
â€˜https://corsproxy.io/?â€™ + encodeURIComponent(url),
â€˜https://api.allorigins.win/raw?url=â€™ + encodeURIComponent(url)
];
var lastErr = â€˜all failedâ€™;
for (var i = 0; i < proxies.length; i++) {
try {
var r = await safeFetch(proxies[i], opts);
if (r && r.ok) return r;
lastErr = â€™HTTP â€™ + (r ? r.status : â€˜?â€™);
} catch(e) { lastErr = e.message; }
}
throw new Error(lastErr);
}

// DNS over HTTPS â€” tries Google then Cloudflare, direct only (both have open CORS)
async function dnsQ(name, type) {
var urls = [
â€˜https://dns.google/resolve?name=â€™ + encodeURIComponent(name) + â€˜&type=â€™ + type,
â€˜https://cloudflare-dns.com/dns-query?name=â€™ + encodeURIComponent(name) + â€˜&type=â€™ + type
];
for (var i = 0; i < urls.length; i++) {
try {
var r = await safeFetch(urls[i], {timeout: 8000, headers: i===1 ? {â€˜Acceptâ€™:â€˜application/dns-jsonâ€™} : {}});
if (r && r.ok) {
var j = await r.json();
if (j && (j.Answer !== undefined || j.Status !== undefined)) return j;
}
} catch(e) {}
}
return null;
}

// â”€â”€ Check functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function chkSSL(d) {
try {
var r = await tryFetch(â€˜https://api.ssllabs.com/api/v3/analyze?host=â€™+encodeURIComponent(d)+â€™&fromCache=on&maxAge=72â€™, {timeout:15000});
var j = await r.json();
if (j.status === â€˜ERRORâ€™) return {s:â€˜failâ€™, d:â€™SSL error: â€™+(j.statusMessage||â€˜unknownâ€™)};
if (j.status !== â€˜READYâ€™) return {s:â€˜warnâ€™, d:â€˜SSL Labs queued â€” re-scan in ~60s (first-time analysis takes longer)â€™};
var gs = (j.endpoints||[]).map(function(e){return e.grade;}).filter(Boolean);
if (!gs.length) return {s:â€˜failâ€™, d:â€˜No SSL endpoints foundâ€™};
var order = [â€˜A+â€™,â€˜Aâ€™,â€˜A-â€™,â€˜Bâ€™,â€˜Câ€™,â€˜Dâ€™,â€˜Eâ€™,â€˜Fâ€™,â€˜Tâ€™];
var worst = gs.sort(function(a,b){return order.indexOf(b)-order.indexOf(a);})[0]||â€˜Tâ€™;
if ([â€˜A+â€™,â€˜Aâ€™].includes(worst)) return {s:â€˜passâ€™, d:â€˜SSL grade â€˜+worst+â€™ â€” strong TLS, valid certificateâ€™};
if ([â€˜A-â€™,â€˜Bâ€™].includes(worst)) return {s:â€˜warnâ€™, d:â€˜SSL grade â€˜+worst+â€™ â€” minor weaknessesâ€™};
return {s:â€˜failâ€™, d:â€˜SSL grade â€˜+worst+â€™ â€” weak or expired certificateâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™SSL Labs unreachable: â€™+e.message}; }
}

async function chkHSTS(d) {
try {
var r = await tryFetch(â€˜https://hstspreload.org/api/v2/status?domain=â€™+encodeURIComponent(d), {timeout:8000});
var j = await r.json();
var s = j.status||â€™â€™;
if (s===â€˜preloadedâ€™) return {s:â€˜passâ€™, d:d+â€™ is on the HSTS preload list â€” HTTPS enforced by all browsersâ€™};
if (s===â€˜pendingâ€™)   return {s:â€˜warnâ€™, d:d+â€™ HSTS preload pending â€” not yet in all browser buildsâ€™};
return {s:â€˜failâ€™, d:d+â€™ not on HSTS preload list â€” SSL stripping possible on first visitâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™HSTS check failed: â€™+e.message}; }
}

async function chkHdrs(d) {
try {
var r = await tryFetch(â€˜https://observatory-api.mdn.mozilla.net/api/v2/analyze?host=â€™+encodeURIComponent(d), {timeout:15000});
var j = await r.json();
var g = j.grade||(j.scan&&j.scan.grade)||â€™â€™;
var sc = j.score!=null ? j.score : (j.scan&&j.scan.score!=null ? j.scan.score : â€˜?â€™);
if (!g) throw new Error(â€˜no grade returnedâ€™);
if ([â€˜A+â€™,â€˜Aâ€™].includes(g)) return {s:â€˜passâ€™, d:â€˜Security headers grade â€˜+g+â€™ (â€™+sc+â€™/100)â€™};
if (g===â€˜Bâ€™) return {s:â€˜warnâ€™, d:â€˜Security headers grade â€˜+g+â€™ (â€™+sc+â€™/100) â€” some headers missingâ€™};
return {s:â€˜failâ€™, d:â€˜Security headers grade â€˜+g+â€™ (â€™+sc+â€™/100) â€” critical headers absentâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™Header scan unavailable: â€™+e.message}; }
}

async function chkCkys(d) {
try {
var q = await dnsQ(d, â€˜Aâ€™);
if (!q||!q.Answer||!q.Answer[0]) throw new Error(â€˜no A recordâ€™);
var ip = q.Answer[0].data;
var r = await tryFetch(â€˜https://internetdb.shodan.io/â€™+ip, {timeout:8000});
var j = await r.json();
var tags = (j.tags||[]).map(function(t){return t.toLowerCase();});
var waf = tags.filter(function(t){return[â€˜cdnâ€™,â€˜wafâ€™,â€˜cloudflareâ€™,â€˜akamaiâ€™,â€˜fastlyâ€™].some(function(w){return t.includes(w);});});
if (waf.length) return {s:â€˜passâ€™, d:â€˜Uses â€˜+waf.join(â€™, â€˜)+â€™ â€” cookies secured via CDN/WAF layerâ€™};
return {s:â€˜warnâ€™, d:â€˜No CDN/WAF detected â€” verify Secure, HttpOnly, SameSite cookie flags manuallyâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™Cookie check failed: â€™+e.message}; }
}

async function chkSPF(d) {
try {
var q = await dnsQ(d, â€˜TXTâ€™);
if (!q) return {s:â€˜skipâ€™, d:â€˜DNS lookup failedâ€™};
var txt = (q.Answer||[]).map(function(a){return a.data;}).join(â€™\nâ€™);
if (!txt.includes(â€˜v=spf1â€™)) return {s:â€˜failâ€™, d:â€˜No SPF record â€” anyone can spoof email from â€˜+d};
if (txt.includes(â€™-allâ€™)) return {s:â€˜passâ€™, d:â€˜SPF -all â€” strict policy, spoofed senders rejectedâ€™};
if (txt.includes(â€˜~allâ€™)) return {s:â€˜warnâ€™, d:â€˜SPF ~all softfail â€” upgrade to -all recommendedâ€™};
return {s:â€˜warnâ€™, d:â€˜SPF ?all neutral â€” provides no real protectionâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™SPF check failed: â€™+e.message}; }
}

async function chkDKIM(d) {
var sels = [â€˜googleâ€™,â€˜selector1â€™,â€˜selector2â€™,â€˜defaultâ€™,â€˜k1â€™,â€˜mailâ€™,â€˜dkimâ€™,â€˜s1â€™,â€˜s2â€™,â€˜smtpâ€™,â€˜mimecastâ€™,â€˜proofpointâ€™];
for (var i = 0; i < sels.length; i++) {
try {
var q = await dnsQ(sels[i]+â€™._domainkey.â€™+d, â€˜TXTâ€™);
if (q&&q.Answer&&q.Answer.length>0) {
var txt = q.Answer.map(function(a){return a.data;}).join(â€™ â€™);
if (txt.includes(â€˜p=â€™)) {
var strong = /p=[A-Za-z0-9+/]{200,}/.test(txt);
return strong ? {s:â€˜passâ€™, d:â€˜DKIM active (selector: â€˜+sels[i]+â€™) â€” strong 2048-bit keyâ€™}
: {s:â€˜warnâ€™, d:â€˜DKIM active (selector: â€˜+sels[i]+â€™) â€” verify key is 2048-bitâ€™};
}
}
} catch(e2) {}
}
return {s:â€˜failâ€™, d:â€™No DKIM record found on â€˜+sels.length+â€™ common selectors for â€™+d};
}

async function chkDMARC(d) {
try {
var q = await dnsQ(â€™_dmarc.â€™+d, â€˜TXTâ€™);
if (!q) return {s:â€˜skipâ€™, d:â€˜DNS lookup failedâ€™};
var txt = (q.Answer||[]).map(function(a){return a.data;}).join(â€™\nâ€™);
if (!txt.includes(â€˜v=DMARC1â€™)) return {s:â€˜failâ€™, d:â€˜No DMARC record â€” email spoofing from â€˜+d+â€™ is trivially easyâ€™};
if (txt.includes(â€˜p=rejectâ€™))     return {s:â€˜passâ€™, d:â€˜DMARC p=reject â€” spoofed mail blocked at recipientâ€™};
if (txt.includes(â€˜p=quarantineâ€™)) return {s:â€˜warnâ€™, d:â€˜DMARC p=quarantine â€” spoofed mail goes to spam, not rejectedâ€™};
return {s:â€˜warnâ€™, d:â€˜DMARC p=none â€” monitoring only, zero enforcementâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™DMARC check failed: â€™+e.message}; }
}

async function chkDNSSEC(d) {
try {
var q = await dnsQ(d, â€˜DSâ€™);
if (!q) return {s:â€˜skipâ€™, d:â€˜DNS lookup failedâ€™};
if (q.Answer&&q.Answer.length>0) return {s:â€˜passâ€™, d:â€˜DNSSEC active â€” DS records present, chain of trust verifiedâ€™};
var q2 = await dnsQ(d, â€˜DNSKEYâ€™);
if (q2&&q2.Answer&&q2.Answer.length>0) return {s:â€˜warnâ€™, d:â€˜DNSKEY found but no DS record â€” chain may be incompleteâ€™};
return {s:â€˜failâ€™, d:â€˜No DNSSEC â€” DNS hijacking and cache poisoning possibleâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™DNSSEC check failed: â€™+e.message}; }
}

async function chkPorts(d) {
try {
var q = await dnsQ(d, â€˜Aâ€™);
if (!q||!q.Answer||!q.Answer[0]) return {s:â€˜skipâ€™, d:â€˜Cannot resolve â€˜+d+â€™ to IPâ€™};
var ip = q.Answer[0].data;
var r = await tryFetch(â€˜https://internetdb.shodan.io/â€™+ip, {timeout:10000});
var j = await r.json();
var ports = j.ports||[];
var danger = ports.filter(function(p){return[21,22,23,3306,5432,3389,5900,27017,6379,9200,8080,445].includes(p);});
if (!ports.length) return {s:â€˜passâ€™, d:â€˜No open ports indexed by Shodan for â€˜+d+â€™ (â€™+ip+â€™)â€™};
if (danger.length) return {s:â€˜failâ€™, d:â€˜Sensitive ports exposed (â€™+ip+â€™): â€˜+danger.join(â€™, â€˜)};
var ns = ports.filter(function(p){return![80,443].includes(p);});
if (ns.length) return {s:â€˜warnâ€™, d:â€˜Non-standard ports open (â€™+ip+â€™): â€˜+ns.join(â€™, â€˜)};
return {s:â€˜passâ€™, d:â€˜Only standard ports (â€™+ports.join(â€™, â€˜)+â€™) exposedâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™Port check failed: â€™+e.message}; }
}

async function chkBreach(d) {
try {
var r = await tryFetch(â€˜https://haveibeenpwned.com/api/v3/breacheddomain/â€™+encodeURIComponent(d), {timeout:8000, headers:{â€˜User-Agentâ€™:â€˜CyberPostureâ€™}});
if (r.status===404) return {s:â€˜passâ€™, d:â€˜No breaches found for â€˜+d+â€™ in HaveIBeenPwnedâ€™};
var j = await r.json();
var list = Array.isArray(j)?j:Object.keys(j);
return list.length ? {s:â€˜failâ€™, d:list.length+â€™ breach(es): â€˜+list.slice(0,3).join(â€™, â€˜)}
: {s:â€˜passâ€™, d:â€˜No breaches for â€˜+d+â€™ in HIBPâ€™};
} catch(e) {
try {
var q = await dnsQ(d,â€˜Aâ€™);
if (q&&q.Answer&&q.Answer[0]) {
var ip = q.Answer[0].data;
var sr = await tryFetch(â€˜https://internetdb.shodan.io/â€™+ip, {timeout:8000});
var sd = await sr.json();
var bad = (sd.tags||[]).filter(function(t){return[â€˜compromisedâ€™,â€˜malwareâ€™,â€˜spamâ€™,â€˜botnetâ€™].some(function(b){return t.toLowerCase().includes(b);});});
if (bad.length) return {s:â€˜failâ€™, d:d+â€™ flagged by Shodan: â€˜+bad.join(â€™, â€™)};
}
} catch(e2) {}
return {s:â€˜skipâ€™, d:â€˜Breach check requires HIBP API key â€” no Shodan flags foundâ€™};
}
}

async function chkCVE(d) {
try {
var q = await dnsQ(d,â€˜Aâ€™);
if (!q||!q.Answer||!q.Answer[0]) return {s:â€˜skipâ€™, d:â€˜Cannot resolve IP for CVE checkâ€™};
var ip = q.Answer[0].data;
var r = await tryFetch(â€˜https://internetdb.shodan.io/â€™+ip, {timeout:10000});
var j = await r.json();
var vulns = j.vulns||[];
if (!vulns.length) return {s:â€˜passâ€™, d:â€˜No known CVEs in Shodan for â€˜+d+â€™ (â€™+ip+â€™)â€™};
var crit=[], high=[];
for (var i=0; i<Math.min(vulns.length,5); i++) {
try {
var nv = await tryFetch(â€˜https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=â€™+encodeURIComponent(vulns[i]), {timeout:6000});
var nd = await nv.json();
var m = nd.vulnerabilities&&nd.vulnerabilities[0]&&nd.vulnerabilities[0].cve&&nd.vulnerabilities[0].cve.metrics;
var sc2 = (m&&((m.cvssMetricV31&&m.cvssMetricV31[0].cvssData.baseScore)||(m.cvssMetricV30&&m.cvssMetricV30[0].cvssData.baseScore)||(m.cvssMetricV2&&m.cvssMetricV2[0].cvssData.baseScore)))||0;
if (sc2>=9) crit.push(vulns[i]); else if (sc2>=7) high.push(vulns[i]);
await sleep(600);
} catch(e2) {}
}
if (crit.length) return {s:â€˜failâ€™, d:vulns.length+â€™ CVE(s) â€” â€˜+crit.length+â€™ critical: â€˜+crit.join(â€™, â€˜)};
if (high.length||vulns.length>3) return {s:â€˜warnâ€™, d:vulns.length+â€™ CVE(s) â€” â€˜+high.length+â€™ high severityâ€™};
return {s:â€˜warnâ€™, d:vulns.length+â€™ lower-severity CVE(s) detectedâ€™};
} catch(e) { return {s:â€˜skipâ€™, d:â€™CVE check failed: â€™+e.message}; }
}

var CFNS=[
{id:â€˜sslâ€™,   fn:chkSSL,    msg:â€˜Querying SSL Labsâ€¦â€™},
{id:â€˜hstsâ€™,  fn:chkHSTS,   msg:â€˜Checking HSTS preloadâ€¦â€™},
{id:â€˜hdrsâ€™,  fn:chkHdrs,   msg:â€˜Mozilla Observatory scanâ€¦â€™},
{id:â€˜ckysâ€™,  fn:chkCkys,   msg:â€˜Checking cookie indicatorsâ€¦â€™},
{id:â€˜spfâ€™,   fn:chkSPF,    msg:â€˜Querying SPF recordâ€¦â€™},
{id:â€˜dkimâ€™,  fn:chkDKIM,   msg:â€˜Checking DKIM selectorsâ€¦â€™},
{id:â€˜dmarcâ€™, fn:chkDMARC,  msg:â€˜Querying DMARC recordâ€¦â€™},
{id:â€˜dnsâ€™,   fn:chkDNSSEC, msg:â€˜Checking DNSSECâ€¦â€™},
{id:â€˜portsâ€™, fn:chkPorts,  msg:â€˜Querying Shodan InternetDBâ€¦â€™},
{id:â€˜breachâ€™,fn:chkBreach, msg:â€˜Checking breach indicatorsâ€¦â€™},
{id:â€˜cveâ€™,   fn:chkCVE,    msg:â€˜Querying NVD for CVEsâ€¦â€™},
];

async function runScan(domain) {
var dom = domain.toLowerCase().trim().replace(/^https?:///,â€™â€™).split(â€™/â€™)[0];
set({screen:â€˜scanâ€™,domain:dom,results:{},scanning:true,progress:0,msg:â€˜Starting scanâ€¦â€™,modal:null});
var res = {};
for (var i=0; i<CFNS.length; i++) {
var c = CFNS[i];
set({msg:c.msg, progress:Math.round((i/CFNS.length)*100)});
try { res[c.id] = await c.fn(dom); } catch(e) { res[c.id] = {s:â€˜skipâ€™, d:â€™Error: â€˜+e.message}; }
set({results:Object.assign({},res)});
}
var sc = calcScore(res), g = getGrade(sc);
var ts = new Date().toLocaleTimeString([],{hour:â€˜2-digitâ€™,minute:â€˜2-digitâ€™})+â€™ â€™+new Date().toLocaleDateString([],{day:â€˜numericâ€™,month:â€˜shortâ€™});
var entry = {id:Date.now(),domain:dom,score:sc,grade:g.g,gradeCol:g.col,gradeLbl:g.lbl,results:res,ts:ts};
var hist = [entry].concat(ST.history.filter(function(h){return h.domain!==dom;})).slice(0,50);
set({scanning:false,progress:100,msg:â€˜Completeâ€™,results:res,history:hist});
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderNav() {
var s = ST.screen;
return [{id:â€˜homeâ€™,ic:â€˜âŒ–â€™,lbl:â€˜SCANâ€™},{id:â€˜scanâ€™,ic:â€˜â—‰â€™,lbl:â€˜RESULTSâ€™},{id:â€˜historyâ€™,ic:â€˜â˜°â€™,lbl:â€˜HISTORYâ€™}]
.map(function(t) {
var on = (s===t.id) ? â€˜onâ€™ : â€˜â€™;
var fn = t.id===â€˜homeâ€™?â€˜goHome()â€™:t.id===â€˜historyâ€™?â€˜goHist()â€™:â€˜goScan()â€™;
return â€˜<button class="nb '+on+'" onclick="'+fn+'"><span class="nb-ic">â€™+t.ic+â€™</span>â€™+t.lbl+â€™</button>â€™;
}).join(â€™â€™);
}

function renderHome() {
var quick = [â€˜Shellâ€™,â€˜HSBCâ€™,â€˜Barclaysâ€™,â€˜Googleâ€™,â€˜Microsoftâ€™,â€˜NCAâ€™,â€˜BBCâ€™,â€˜Teslaâ€™,â€˜BAâ€™,â€˜Netflixâ€™,â€˜Amazonâ€™,â€˜Nvidiaâ€™];
return â€˜<div class="hdr">â€™+
â€˜<div class="logo-dot"></div>â€™+
â€˜<div><div style="font-size:12px;font-weight:800;letter-spacing:.15em;color:#34d399">CYBERPOSTURE</div>â€™+
â€˜<div style="font-size:9px;color:#64748b;letter-spacing:.08em">LIVE OSINT SCANNER</div></div>â€™+
â€˜<span class="live-badge" style="margin-left:auto"><span class="live-dot"></span>LIVE DATA</span>â€™+
â€˜</div>â€™+
â€˜<div style="padding:14px">â€™+
â€˜<div class="card" style="margin-bottom:14px">â€™+
â€˜<div class="slabel">Company or Domain</div>â€™+
â€˜<input type="text" id="srch" value="'+esc(ST.input)+'" placeholder="shell.com Â· HSBC Â· google.comâ€¦" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" oninput="ST.input=this.value;updateBtn()" onkeydown="if(event.key===\'Enter\'&&ST.input.trim())doScan()">â€™+
â€˜<button class=â€œbtn-goâ€ id=â€œgobtnâ€ onclick=â€œdoScan()â€ â€˜+(ST.input.trim()?â€™â€™:â€˜disabledâ€™)+â€™>â–¶  Run Live Assessment</button>â€™+
â€˜</div>â€™+
â€˜<div class="slabel">Quick Scans</div>â€™+
â€˜<div style="display:flex;flex-wrap:wrap;gap:7px;margin-bottom:14px">â€™+
quick.map(function(q){return â€˜<button class="pill" onclick="quickScan(\''+q+'\')">â€™+q+â€™</button>â€™;}).join(â€™â€™)+
â€˜</div>â€™+
â€˜<div style="padding:10px 12px;background:#f8fafc;border:1.5px solid #e2e8f0;border-radius:10px;font-size:9px;color:#94a3b8;line-height:1.9">â€™+
â€˜SOURCES: SSL Labs Â· HSTS Preload Â· Mozilla Observatory Â· Google DNS Â· Shodan Â· NVD Â· HaveIBeenPwnedâ€™+
â€˜</div>â€™+
â€˜</div>â€™;
}

function renderScan() {
var res=ST.results, dom=ST.domain, scanning=ST.scanning;
var sc=calcScore(res), g=getGrade(sc);
var pc=CHECKS.filter(function(c){return res[c.id]&&res[c.id].s===â€˜passâ€™;}).length;
var wc=CHECKS.filter(function(c){return res[c.id]&&res[c.id].s===â€˜warnâ€™;}).length;
var fc=CHECKS.filter(function(c){return res[c.id]&&res[c.id].s===â€˜failâ€™;}).length;
var skc=CHECKS.filter(function(c){return !res[c.id]||res[c.id].s===â€˜skipâ€™;}).length;
var done=CHECKS.filter(function(c){return !!res[c.id];}).length;

var topCard = â€˜â€™;
if (scanning) {
topCard = â€˜<div class="card" style="margin-bottom:12px">â€™+
â€˜<div style="display:flex;justify-content:space-between;margin-bottom:8px">â€™+
â€˜<div style="font-size:11px;font-weight:700;color:#334155">â€™+esc(ST.msg)+â€™</div>â€™+
â€˜<div style="font-size:11px;color:#94a3b8">â€™+done+â€™/â€™+CHECKS.length+â€™</div>â€™+
â€˜</div>â€™+
â€˜<div class="prog-track"><div class="prog-fill" style="width:'+ST.progress+'%"></div></div>â€™+
â€˜</div>â€™;
} else if (sc !== null) {
var off = 226-(sc/100)*226;
topCard = â€˜<div class="card" style="display:flex;align-items:center;gap:16px;margin-bottom:12px">â€™+
â€˜<div class="ring-wrap">â€™+
â€˜<svg width="80" height="80"><circle cx="40" cy="40" r="36" fill="none" stroke="#e2e8f0" stroke-width="7"/><circle cx="40" cy="40" r="36" fill="none" stroke="'+g.col+'" stroke-width="7" stroke-dasharray="226" stroke-dashoffset="'+off+'" stroke-linecap="round" transform="rotate(-90 40 40)"/></svg>â€™+
â€˜<div class="ring-inner"><div style="font-size:18px;font-weight:800;color:#0f172a;line-height:1">â€™+sc+â€™</div><div style="font-size:8px;color:#94a3b8">/100</div></div>â€™+
â€˜</div>â€™+
â€˜<div>â€™+
â€˜<div style="font-size:30px;font-weight:800;color:'+g.col+';line-height:1">â€™+g.g+â€™</div>â€™+
â€˜<div style="font-size:13px;font-weight:700;color:#334155;margin-top:3px">â€™+g.lbl+â€™</div>â€™+
â€˜<div style="margin-top:8px;font-size:12px;line-height:2">â€™+
â€˜<span style="color:#059669;font-weight:700">âœ“ â€˜+pc+â€™  </span>â€™+
â€˜<span style="color:#d97706;font-weight:700">âš  â€˜+wc+â€™  </span>â€™+
â€˜<span style="color:#dc2626;font-weight:700">âœ• â€˜+fc+â€™</span>â€™+
(skc>0 ? â€™ <span style="color:#94a3b8;font-size:10px">â€” â€˜+skc+â€™ unverifiable</span>â€™ : â€˜â€™)+
â€˜</div>â€™+
â€˜</div>â€™+
â€˜</div>â€™;
}

var rows = CHECKS.map(function(c,i) {
var r=res[c.id], st=r?r.s:â€˜skipâ€™;
var detail=r&&r.d?r.d:(scanning&&!r?â€˜Pendingâ€¦â€™:â€™â€”â€™);
var detCol=st===â€˜skipâ€™?â€™#94a3b8â€™:â€™#475569â€™;
var ns=(st===â€˜skipâ€™&&!scanning)?â€™<span class="nstag">NOT SCORED</span>â€™:â€™â€™;
var arr=(r&&!scanning)?â€™<div style="color:#cbd5e1;font-size:16px;margin-left:2px">â€º</div>â€™:â€™â€™;
return â€˜<div class="chkrow" onclick="openModal(\''+c.id+'\')" style="'+(i===CHECKS.length-1?'border-bottom:none':'')+'">â€™+
dotEl(st)+
â€˜<div style="flex:1;min-width:0">â€™+
â€˜<div style="display:flex;align-items:center;gap:5px;flex-wrap:wrap">â€™+
â€˜<span style="font-size:13px;font-weight:700;color:#0f172a">â€™+c.label+â€™</span>â€™+ns+
â€˜</div>â€™+
(scanning&&!r ? â€˜<div class="shimmer" style="height:9px;width:55%;margin-top:5px"></div>â€™
: â€˜<div style="font-size:11px;color:'+detCol+';margin-top:3px;line-height:1.5">â€™+esc(detail)+â€™</div>â€™)+
â€˜<div style="font-size:10px;color:#94a3b8;margin-top:2px">â€™+c.cat+â€™ Â· â€˜+(st===â€˜skipâ€™?â€˜excludedâ€™:c.w+â€˜ptsâ€™)+â€™</div>â€™+
â€˜</div>â€™+arr+
â€˜</div>â€™;
}).join(â€™â€™);

var fails = CHECKS.filter(function(c){return res[c.id]&&res[c.id].s===â€˜failâ€™;}).sort(function(a,b){return b.w-a.w;}).slice(0,4);
var priority = (!scanning&&fails.length) ?
â€˜<div style="margin-bottom:14px">â€™+
â€˜<div class="slabel">Priority Actions</div>â€™+
â€˜<div class="prio-box">â€™+
fails.map(function(c,i){
return â€˜<div style="display:flex;gap:10px;margin-bottom:'+(i<fails.length-1?'12px':'0')+'">â€™+
â€˜<div class="prio-num">â€™+(i+1)+â€™</div>â€™+
â€˜<div><div style="font-size:12px;font-weight:700;color:#dc2626">â€™+c.label+â€™</div>â€™+
â€˜<div style="font-size:11px;color:#475569;margin-top:3px;line-height:1.5">â€™+esc(res[c.id].d)+â€™</div></div>â€™+
â€˜</div>â€™;
}).join(â€™â€™)+
â€˜</div>â€™+
â€˜</div>â€™ : â€˜â€™;

return â€˜<div class="hdr">â€™+
â€˜<button class="back-btn" onclick="goHome()">â†</button>â€™+
â€˜<div style="flex:1;min-width:0">â€™+
â€˜<div style="font-size:14px;font-weight:700;color:#f8fafc;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">â€™+esc(dom)+â€™</div>â€™+
â€˜<div style="font-size:10px;color:#64748b">â€™+(scanning?â€˜Live scan in progressâ€¦â€™:sc!==null?â€˜Score â€˜+sc+â€™/100 Â· â€˜+g.lbl:â€˜Scan completeâ€™)+â€™</div>â€™+
â€˜</div>â€™+
â€˜<span class="live-badge"><span class="live-dot"></span>LIVE</span>â€™+
â€˜</div>â€™+
â€˜<div style="flex:1;overflow-y:auto;padding:14px">â€™+
topCard+
â€˜<div class="slabel">Security Checksâ€™+(scanning?â€™â€™:â€™ Â· tap for detailâ€™)+â€™</div>â€™+
â€˜<div class="card" style="padding:0;overflow:hidden;margin-bottom:14px">â€™+rows+â€™</div>â€™+
priority+
â€˜<div style="height:10px"></div>â€™+
â€˜</div>â€™;
}

function renderHistory() {
return â€˜<div class="hdr">â€™+
â€˜<div class="logo-dot"></div>â€™+
â€˜<div style="flex:1"><div style="font-size:14px;font-weight:800;color:#f8fafc">Scan History</div></div>â€™+
(ST.history.length ? â€˜<button onclick="clearHist()" style="background:rgba(220,38,38,.2);border:1.5px solid rgba(220,38,38,.4);color:#fca5a5;border-radius:8px;padding:6px 12px;font-size:11px;font-weight:700;cursor:pointer;font-family:inherit">Clear</button>â€™ : â€˜â€™)+
â€˜</div>â€™+
â€˜<div style="flex:1;overflow-y:auto;padding:14px">â€™+
(!ST.history.length ?
â€˜<div style="text-align:center;padding:60px 0;color:#94a3b8"><div style="font-size:32px;margin-bottom:8px">ğŸ”</div><div style="font-size:14px;font-weight:700;color:#334155">No scans yet</div></div>â€™ :
ST.history.map(function(r){
return â€˜<div class="hist-row" onclick="loadHist(\''+esc(r.domain)+'\')">â€™+
â€˜<div style="width:40px;height:40px;border-radius:10px;background:'+r.gradeCol+';color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:18px;flex-shrink:0">â€™+r.grade+â€™</div>â€™+
â€˜<div style="flex:1;min-width:0">â€™+
â€˜<div style="font-size:13px;font-weight:800;color:#0f172a;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">â€™+esc(r.domain)+â€™</div>â€™+
â€˜<div style="font-size:11px;color:#64748b">â€™+r.gradeLbl+â€™ Â· â€˜+(r.score!==null?r.score+â€™/100â€™:â€™â€”â€™)+â€™</div>â€™+
â€˜</div>â€™+
â€˜<div style="font-size:10px;color:#94a3b8;text-align:right">â€™+esc(r.ts||â€™â€™)+â€™</div>â€™+
â€˜</div>â€™;
}).join(â€™â€™))+
â€˜</div>â€™;
}

function renderModal() {
if (!ST.modal||!ST.results[ST.modal]) return â€˜â€™;
var c = CHECKS.find(function(x){return x.id===ST.modal;});
var r = ST.results[ST.modal];
var lblM={pass:â€˜PASSINGâ€™,warn:â€˜WARNINGâ€™,fail:â€˜FAILINGâ€™,skip:â€˜NOT SCOREDâ€™};
var colM={pass:â€™#059669â€™,warn:â€™#d97706â€™,fail:â€™#dc2626â€™,skip:â€™#94a3b8â€™};
var lbl=lblM[r.s]||r.s, col=colM[r.s]||â€™#94a3b8â€™;
return â€˜<div class="modal-bg" onclick="closeModal()">â€™+
â€˜<div class="modal-box" onclick="event.stopPropagation()">â€™+
â€˜<div class="modal-handle"></div>â€™+
â€˜<div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">â€™+dotEl(r.s)+
â€˜<div style="font-size:16px;font-weight:800;color:#0f172a">â€™+c.label+â€™</div>â€™+
â€˜</div>â€™+
â€˜<div style="margin-bottom:16px">â€™+
â€˜<span style="display:inline-block;padding:4px 12px;border-radius:20px;background:'+col+'15;color:'+col+';font-size:11px;font-weight:700;margin-right:6px">â€™+lbl+â€™</span>â€™+
â€˜<span style="font-size:11px;color:#94a3b8">â€™+c.cat+â€™ Â· â€˜+c.w+â€™ pts</span>â€™+
â€˜</div>â€™+
â€˜<div style="background:#f8fafc;border:1.5px solid #e2e8f0;border-radius:12px;padding:14px;font-size:13px;color:#334155;line-height:1.7;margin-bottom:20px">â€™+esc(r.d)+â€™</div>â€™+
â€˜<button onclick="closeModal()" style="width:100%;padding:15px;background:#0f172a;border:none;border-radius:12px;color:#fff;font-weight:800;font-size:15px;cursor:pointer;font-family:inherit">Close</button>â€™+
â€˜</div>â€™+
â€˜</div>â€™;
}

function render() {
var s = ST.screen;
document.getElementById(â€˜screenâ€™).innerHTML = s===â€˜homeâ€™?renderHome():s===â€˜scanâ€™?renderScan():renderHistory();
document.getElementById(â€˜navâ€™).innerHTML = renderNav();
document.getElementById(â€˜modalrootâ€™).innerHTML = ST.modal?renderModal():â€™â€™;
}

function updateBtn(){var b=document.getElementById(â€˜gobtnâ€™);if(b)b.disabled=!ST.input.trim();}
function doScan(){if(!ST.input.trim()||ST.scanning)return;runScan(toDom(ST.input.trim()));}
function quickScan(q){if(ST.scanning)return;ST.input=q;runScan(toDom(q));}
function goHome(){set({screen:â€˜homeâ€™,modal:null});}
function goScan(){if(ST.domain)set({screen:â€˜scanâ€™,modal:null});}
function goHist(){set({screen:â€˜historyâ€™,modal:null});}
function openModal(id){if(ST.results[id]&&!ST.scanning)set({modal:id});}
function closeModal(){set({modal:null});}
function clearHist(){set({history:[]});}
function loadHist(dom){
var r = ST.history.find(function(h){return h.domain===dom;});
if(r) set({screen:â€˜scanâ€™,domain:r.domain,results:r.results,scanning:false,progress:100,msg:â€˜Loaded from historyâ€™,modal:null});
}

render();
</script>

</body>
</html>